<!doctype html>
<html>

<head>
  <title>asdf</title>
  <style>
    a:hover,
    a:active {
      /*-webkit-tap-highlight-color: rgba(255, 0, 0, 0.5);
      -webkit-user-select: none;
      -webkit-touch-callout: none;*/
    }
  </style>
  <!-- set viewport -->
  <script>
    var meta = document.createElement("meta");
    meta.setAttribute('name', 'viewport');
    meta.setAttribute('content', 'initial-scale=' + (1 / window.devicePixelRatio) + ',user-scalable=no');
    document.getElementsByTagName('head')[0].appendChild(meta);
  </script>
</head>

<body onload="startup()">

  <a href="#">here</a>

  <script type="text/javascript">
    // var pa = document.getElementsByTagName('a')[0];
    //
    // pa.onclick = function() {
    //   // Trigger the `hover` event on the paragraph
    //   pa.onhover.call(pa);
    // };


    function startup() {
      var el = document.getElementsByTagName("html")[0];
      el.addEventListener("touchstart", handleStart, true);
      el.addEventListener("touchend", handleEnd, false);
      el.addEventListener("touchcancel", handleCancel, false);
      el.addEventListener("touchmove", handleMove, false);
      // el.addEventListener("click", modifyText, false);
      console.log("initialized.");
    }

    var ongoingTouches = [];

    function handleStart(evt) {
      evt.preventDefault();
      // console.log("touchstart.");
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        ongoingTouches.push(copyTouch(touches[i]));
        console.log("touchstart:" + i);
      }
    }

    function handleMove(evt) {
      evt.preventDefault();
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        var idx = ongoingTouchIndexById(touches[i].identifier);

        if (idx >= 0) {
          console.log("continuing touch " + idx);
          console.log("ongoingTouches(" + ongoingTouches[idx].pageX + ", " + ongoingTouches[idx].pageY + ");");
          console.log("justTouches(" + touches[i].pageX + ", " + touches[i].pageY + ");");

          ongoingTouches.splice(idx, 1, copyTouch(touches[i])); // swap in the new touch record
        } else {
          console.log("can't figure out which touch to continue");
        }
      }
    }

    function handleEnd(evt) {
      evt.preventDefault();
      console.log("touchend");
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        var idx = ongoingTouchIndexById(touches[i].identifier);

        if (idx >= 0) {
          ongoingTouches.splice(idx, 1); // remove it; we're done
        } else {
          console.log("can't figure out which touch to end");
        }
      }
    }

    function handleCancel(evt) {
      evt.preventDefault();
      console.log("touchcancel.");
      var touches = evt.changedTouches;

      for (var i = 0; i < touches.length; i++) {
        ongoingTouches.splice(i, 1); // remove it; we're done
      }
    }

    function copyTouch(touch) {
      return {
        identifier: touch.identifier,
        pageX: touch.pageX,
        pageY: touch.pageY
      };
    }

    function ongoingTouchIndexById(idToFind) {
      for (var i = 0; i < ongoingTouches.length; i++) {
        var id = ongoingTouches[i].identifier;

        if (id == idToFind) {
          return i;
        }
      }
      return -1; // not found
    }
  </script>



</body>

</html>
